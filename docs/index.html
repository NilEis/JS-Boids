<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Boids</title></head><body style="margin: 0px;overflow: hidden;"></body><script>(()=>{"use strict";class t{constructor(){}static clamp(t,i,s){return Math.min(Math.max(t,+s),i)}}function i(t,i,s){return t*(1-s)+i*s}class s{constructor(t,i,s={}){this.GC_OPTIMATION={t:0,nx:0,ny:0,vl:0,force:{x:0,y:0,strength:0}},this._game=t,this.x=s.x||this._game.dimension.width*Math.random(),this.y=s.y||this._game.dimension.height*Math.random(),this.v=s.v||.5-Math.random()+2,this.size=s.size||.5,this.d={x:this.v-Math.random()*(2*this.v),y:this.v-Math.random()*(2*this.v)},this.ctx=i,this.timer=new Map,this.timer.set("random_movement",0),this.force=new Map,this.neighbours=new Set,this.id=this._game.next_id,this.detection_radius=45,this.indicies=null,this._game.grid.new_client(this),this.active=!1;const e=16*Math.random()*Math.PI;this.force.set("random_movement",{x:Math.sin(e),y:Math.cos(e),strength:.07})}update(t){this.get_neighbors(this.detection_radius);for(let[t,i]of this.timer)this.timer.set(t,i+1);if(this.GC_OPTIMATION.t=1-Math.pow(.01,t),this.GC_OPTIMATION.nx=i(this.x,this.x+this.d.x*this.v,this.GC_OPTIMATION.t),this.GC_OPTIMATION.ny=i(this.y,this.y+this.d.y*this.v,this.GC_OPTIMATION.t),this.GC_OPTIMATION.nx<this._game.dimension.width&&this.GC_OPTIMATION.nx>0?this.x=this.GC_OPTIMATION.nx:this.d.x*=-.4,this.GC_OPTIMATION.ny<this._game.dimension.height&&this.GC_OPTIMATION.ny>0?this.y=this.GC_OPTIMATION.ny:this.d.y*=-.4,(this.timer.get("random_movement")||1)%(40+Math.floor(20*Math.random()))==0){const t=16*Math.random()*Math.PI;this.force.set("random_movement",{x:Math.sin(t),y:Math.cos(t),strength:.07})}this.force.set("separation_force",this.calculate_separation_force(.062)),this.force.set("alignment_force",this.calculate_alignment_force(.089)),this.force.set("center_force",this.calculate_center_force(.125)),this.force.set("mouse_force",this.calculate_mouse_force(.081));for(let[t,i]of this.force)this.d.x+=i.x*i.strength,this.d.y+=i.y*i.strength;this.d.x=this.d.x||this.force.get("random_movement").x,this.d.y=this.d.y||this.force.get("random_movement").y,this.d.x*=1/Math.sqrt(this.d.x*this.d.x+this.d.y*this.d.y),this.d.y*=1/Math.sqrt(this.d.x*this.d.x+this.d.y*this.d.y),this._game.grid.update_client(this),this.x&&this.y&&this.d.x&&this.d.y||alert()}draw(){const t=this.ctx.fillStyle;this.GC_OPTIMATION.nx=1,this.GC_OPTIMATION.ny=-this.d.x/this.d.y,this.GC_OPTIMATION.vl=Math.sqrt(1+this.GC_OPTIMATION.ny*this.GC_OPTIMATION.ny),this.GC_OPTIMATION.nx/=this.GC_OPTIMATION.vl,this.GC_OPTIMATION.ny/=this.GC_OPTIMATION.vl,this.ctx.beginPath(),this.ctx.moveTo(this.x+this.d.x*this.size*10,this.y+this.d.y*this.size*10),this.ctx.lineTo(-this.d.x*(2*this.size)+this.x+this.GC_OPTIMATION.nx*(4*this.size),-this.d.y*(2*this.size)+this.y+this.GC_OPTIMATION.ny*(4*this.size)),this.ctx.lineTo(this.x,this.y),this.ctx.lineTo(-this.d.x*(2*this.size)+this.x-this.GC_OPTIMATION.nx*(4*this.size),-this.d.y*(2*this.size)+this.y-this.GC_OPTIMATION.ny*(4*this.size)),this.ctx.closePath(),this.ctx.fillStyle="rgb(0,0,0)",this.ctx.fill(),this.ctx.fillStyle=t}calculate_alignment_force(t){if(0==this.neighbours.size)return{x:0,y:0,strength:0};this.GC_OPTIMATION.force={x:0,y:0,strength:t};for(let t of this.neighbours)this.GC_OPTIMATION.force.x+=t.d.x||0,this.GC_OPTIMATION.force.y+=t.d.y||0;return this.GC_OPTIMATION.force.x/=this.neighbours.size,this.GC_OPTIMATION.force.y/=this.neighbours.size,this.GC_OPTIMATION.force.x*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),this.GC_OPTIMATION.force.y*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),{x:this.GC_OPTIMATION.force.x,y:this.GC_OPTIMATION.force.y,strength:this.GC_OPTIMATION.force.strength}}calculate_center_force(t){if(0==this.neighbours.size)return{x:0,y:0,strength:0};this.GC_OPTIMATION.force={x:0,y:0,strength:t};for(let t of this.neighbours)this.GC_OPTIMATION.force.x+=t.x||0,this.GC_OPTIMATION.force.y+=t.y||0;return this.GC_OPTIMATION.force.x/=this.neighbours.size,this.GC_OPTIMATION.force.y/=this.neighbours.size,this.GC_OPTIMATION.force.x-=this.x,this.GC_OPTIMATION.force.y-=this.y,this.GC_OPTIMATION.force.x*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),this.GC_OPTIMATION.force.y*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),this.neighbours.size/(this._game.objects.length-1)>=.35&&(this.GC_OPTIMATION.force.x*=-1,this.GC_OPTIMATION.force.y*=-1),{x:this.GC_OPTIMATION.force.x,y:this.GC_OPTIMATION.force.y,strength:this.GC_OPTIMATION.force.strength}}calculate_mouse_force(t){return this._game.mouse.pressed?(this.GC_OPTIMATION.force={x:this._game.mouse.x,y:this._game.mouse.y,strength:t},this.GC_OPTIMATION.force.x-=this.x,this.GC_OPTIMATION.force.y-=this.y,this.GC_OPTIMATION.force.x*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),this.GC_OPTIMATION.force.y*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),{x:this.GC_OPTIMATION.force.x,y:this.GC_OPTIMATION.force.y,strength:this.GC_OPTIMATION.force.strength}):{x:0,y:0,strength:0}}calculate_separation_force(t){if(0==this.neighbours.size)return{x:0,y:0,strength:0};this.GC_OPTIMATION.force={x:0,y:0,strength:t};for(let t of this.neighbours)this.GC_OPTIMATION.force.x+=(this.x-t.x)/Math.sqrt(this.distance_to(t))||0,this.GC_OPTIMATION.force.y+=(this.y-t.y)/Math.sqrt(this.distance_to(t))||0;return this.GC_OPTIMATION.force.x*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),this.GC_OPTIMATION.force.y*=1/Math.sqrt(this.GC_OPTIMATION.force.x*this.GC_OPTIMATION.force.x+this.GC_OPTIMATION.force.y*this.GC_OPTIMATION.force.y),{x:this.GC_OPTIMATION.force.x,y:this.GC_OPTIMATION.force.y,strength:this.GC_OPTIMATION.force.strength}}get_neighbors(t){this.neighbours=this._game.grid.find_near({x:this.x,y:this.y},{width:t,height:t})}distance_to(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)}}const e=[];e.width=5,e.height=7,e.A=[0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,0],e.B=[1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0],e.C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.D=[1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0],e.E=[1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,0],e.F=[1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0],e.G=[0,1,1,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,1,0,1,0,0,1,0,0,1,1,0,0],e.H=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.I=[1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,1,1,0,0],e.I.offset=-1,e.J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.L=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,0],e.M=[1,0,0,0,1,1,1,0,1,1,1,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1],e.M.offset=1,e.N=[1,0,0,1,0,1,0,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0],e.O=[0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e.P=[1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0],e.Q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.R=[1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0],e.S=[0,1,1,0,0,1,0,0,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e.T=[1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0],e.T.offset=-1,e.U=[1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e.V=[1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0],e.V.offset=1,e.W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.X=[1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,1,0,0,0,1],e.X.offset=1,e.Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e[0]=[0,1,1,0,0,1,0,0,1,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e[1]=[0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,1,1,0,0],e[2]=[0,1,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,0],e[3]=[0,1,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e[4]=[0,0,1,1,0,0,1,0,1,0,1,0,0,1,0,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0],e[5]=[1,1,1,1,0,1,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,1,1,1,0,0],e[6]=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e[7]=[1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0],e[8]=[0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0],e[9]=[0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],e[" "]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e[" "].offset=-2,e[","]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0],e["+"]=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],e["-"]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e["("]=[0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0],e[")"]=[0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0],e[":"]=[0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0],e[":"].offset=-2;class h{constructor(t,i){this.bounds=t,this.dimensions=i,this.cells=new Map}new_client(t){t.indicies=null,this.insert(t)}insert(t){var i;const s=t.x,e=t.y,h=t.size,o=t.size,n=this.get_index([s-h/2,e-o/2]),r=this.get_index([s+h/2,e+o/2]);t.indicies=[[n[0],n[1]],[r[0],r[1]]];let c="";for(let s=n[0];s<=r[0];s++)for(let e=n[1];e<=r[1];e++)c=this.get_key(s,e),this.cells.has(c)||this.cells.set(c,new Set),null===(i=this.cells.get(c))||void 0===i||i.add(t)}get_index(i){const s=t.clamp(0,1,i[0]/this.bounds.width),e=t.clamp(0,1,i[1]/this.bounds.height);return[Math.floor(s*(this.dimensions.width-1)),Math.floor(e*(this.dimensions.height-1))]}get_key(t,i){return t+"."+i}find_near(t,i){const s=t.x,e=t.y,h=i.width,o=i.height,n=this.get_index([s-h/2,e-o/2]),r=this.get_index([s+h/2,e+o/2]),c=new Set;let T,a="";for(let t=n[0];t<=r[0];t++)for(let i=n[1];i<=r[1];i++)if(a=this.get_key(t,i),this.cells.has(a)){T=this.cells.get(a)||new Set;for(const t of T)c.add(t)}return c}update_client(t){const i=t.x,s=t.y,e=t.size,h=t.size,o=this.get_index([i-e/2,s-h/2]),n=this.get_index([i+e/2,s+h/2]);null!=t.indicies&&t.indicies[0][0]==o[0]&&t.indicies[0][1]==o[1]&&t.indicies[1][0]==n[0]&&t.indicies[1][1]==n[1]||(this.remove_client(t),this.insert(t))}remove_client(t){var i;const s=null==t.indicies?[0,0]:t.indicies[0],e=null==t.indicies?[0,0]:t.indicies[1];let h="";for(let o=s[0];o<=e[0];o++)for(let n=s[1];n<=e[1];n++)h=this.get_key(o,n),null===(i=this.cells.get(h))||void 0===i||i.delete(t)}}var o=0,n=new Set;requestAnimationFrame((function t(i){n.forEach((function(t){t.running&&t.loop(i)})),requestAnimationFrame(t)})),document.body.innerHTML="",new class{constructor(t={canvas:void 0,dimension:{width:void 0,height:void 0},color:void 0}){o++,this.n_id=0,this.canvas=t.canvas||function(){const t=document.createElement("canvas");return document.body.append(t),t}(),this.canvas.setAttribute("id","game_canvas_"+o),this.canvas.style.margin="0px;",this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.dimension={width:0,height:0},t.dimension=t.dimension||{width:void 0,height:void 0},this.dimension.width=t.dimension.width||600,this.dimension.height=t.dimension.height||400,this.size=this.dimension,this.color_a=t.color||"gray",this.steps=t.steps||1,this.startingTime=0,this.lastTime=0,this.totalElapsedTime=0,this.running=!1,this.objects=new Array,this.grid=new h(this.dimension,{width:25,height:25}),this.mouse={pressed:!1,x:0,y:0},this.canvas.onmousedown=t=>{this.mouse.pressed=!0,this.mouse.x=t.pageX,this.mouse.y=t.pageY},this.canvas.onmouseup=t=>{this.mouse.pressed=!1,this.mouse.x=t.pageX,this.mouse.y=t.pageY},this.canvas.onmousemove=t=>{this.mouse.x=t.pageX,this.mouse.y=t.pageY},document.body.onkeypress=t=>{"a"==t.key?this.objects.push(new s(this,this.ctx)):"r"==t.key?this.objects.pop():"+"==t.key?this.steps++:"-"==t.key&&this.steps--},this.draw()}start(){for(let t=0;t<250;t++)this.objects.push(new s(this,this.ctx));this.startingTime=performance.now(),this.lastTime=performance.now(),this.totalElapsedTime=0,this.running=!0,n.has(this)||n.add(this)}draw(){this.ctx.fillStyle=this.color_a,this.ctx.fillRect(0,0,this.dimension.width,this.dimension.height);for(let t=0;t<this.objects.length;t++)this.objects[t].draw();this.fillText(15,15,"Boids (a,r): "+this.objects.length,15),this.fillText(15,35,"Speed (+,-): "+this.steps+"x",15)}update(i){this.steps=t.clamp(0,1/0,this.steps);for(let t=0;t<this.objects.length;t++)for(let s=0;s<this.steps;s++)this.objects[t].update(i)}loop(t){var i=t-this.lastTime;this.totalElapsedTime+=i,this.lastTime=t,this.update(i),this.draw()}set size(t){this.canvas.width=t.width,this.canvas.height=t.height,this.dimension.width=t.width,this.dimension.height=t.height}set color(t){this.color_a=t}get next_id(){return this.n_id++}fillText(t,i,s,h,o="white"){const n=h/e.width,r=h/e.height;var c=0;for(let h=0;h<s.length;h++){c+=null!=e[s.charAt(h-1).toUpperCase()]&&null!=e[s.charAt(h-1).toUpperCase()].offset?e[s.charAt(h-1).toUpperCase()].offset:0;const o=s.charAt(h).toUpperCase();for(let s=0;s<e.height;s++)for(let T=0;T<e.width;T++){const a=s*e.width+T,I=c*n+t+h*n*e.width+T*n,O=i+s*r;1==e[o][a]&&(this.ctx.fillStyle="white",this.ctx.fillRect(I,O,n+1,r+1))}}}}({dimension:{width:window.innerWidth,height:window.innerHeight}}).start()})();</script></html>